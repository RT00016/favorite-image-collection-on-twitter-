from requests_oauthlib import OAuth1Session
from datetime import datetime
from time import sleep
import os.path
import urllib.request as req
import json


user_id = #insert your twitter id
CONSUMER_KEY = # these are spaces where you need to put TwitterAPI you have gotten  
CONSUMER_SECRET = # these are spaces where you need to put TwitterAPI you have gotten
ACCESS_TOKEN = # these are spaces where you need to put TwitterAPI you have gotten
ACCESS_TOKEN_SECRET = # these are spaces where you need to put TwitterAPI you have gotten

twitter = OAuth1Session(CONSUMER_KEY, CONSUMER_SECRET, ACCESS_TOKEN, ACCESS_TOKEN_SECRET)

def save_img(tweet_json, save_dir):
    if not os.path.exists(save_dir): os.makedirs(save_dir)
    
    for tweet in tweet_json:
        name = tweet['user']['screen_name']
        favo = tweet['favorite_count']
        #print(tweet)
        date = tweet['created_at']
        date = date.replace(" +0000","")
        date = date.replace(" ","-")
        date = date.replace(":",",")
        
        try:
            media_list = tweet['entities']['media']
            for img in media_list:
                img_url = img['media_url']
                path = save_dir + "/[" + str(name) + "]_" + str(date) + ".jpg"
                #print(path)
                req.urlretrieve(img_url, path)
                print("preservation images are completed", img_url)
                print("-・"*30)
                
        except Exception as e:
            print("something Error happen")
            #print(tweet_json)
            print("-・"*30)
                    
    




url = "https://api.twitter.com/1.1/favorites/list.json"
params = {'screen_name': user_id, 'count': 200}
res = twitter.get(url, params = params)

if res.status_code == 200:
    r = json.loads(res.text)
    print(len(r))
    print(r[0]["id"])
    print(r[-1]["id"])
    
    
save_img(r, "./savefile")

